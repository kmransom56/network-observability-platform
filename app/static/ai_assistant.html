<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - Network Observability Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a; color: #e0e0e0; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #4a9eff; margin-bottom: 20px; }
        .status-bar {
            background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .backend-selector { display: flex; gap: 10px; flex-wrap: wrap; }
        .backend-btn {
            padding: 8px 16px; border: 1px solid #4a9eff; background: #2a2a2a;
            color: #4a9eff; border-radius: 4px; cursor: pointer; transition: all 0.2s;
        }
        .backend-btn:hover { background: #3a3a3a; }
        .backend-btn.active { background: #4a9eff; color: #1a1a1a; }
        .backend-btn.available::before { content: "âœ“ "; color: #4aff4a; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #2a2a2a; }
        .tab {
            padding: 10px 20px; background: transparent; border: none; color: #888;
            cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;
        }
        .tab.active { color: #4a9eff; border-bottom-color: #4a9eff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #aaa; }
        input, textarea, select {
            width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a;
            border-radius: 4px; color: #e0e0e0; font-family: inherit;
        }
        textarea { min-height: 150px; resize: vertical; }
        button {
            padding: 12px 24px; background: #4a9eff; color: #1a1a1a; border: none;
            border-radius: 4px; cursor: pointer; font-weight: bold;
        }
        button:hover { background: #5aaeff; }
        .result {
            margin-top: 20px; padding: 20px; background: #2a2a2a; border-radius: 8px;
            border-left: 4px solid #4a9eff;
        }
        .result h3 { color: #4a9eff; margin-bottom: 10px; }
        .result pre {
            background: #1a1a1a; padding: 15px; border-radius: 4px; overflow-x: auto;
            white-space: pre-wrap; word-wrap: break-word;
        }
        .loading {
            display: inline-block; width: 20px; height: 20px; border: 3px solid #3a3a3a;
            border-top-color: #4a9eff; border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error {
            color: #ff4a4a; background: #3a1a1a; padding: 10px; border-radius: 4px; margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ¤– AI Assistant</h1>
        <div class="status-bar">
            <div><strong>Status:</strong> <span id="status">Loading...</span></div>
            <div class="backend-selector" id="backendSelector"></div>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="showTab('chat')">Chat</button>
            <button class="tab" onclick="showTab('audit')">Audit</button>
            <button class="tab" onclick="showTab('repair')">Repair</button>
            <button class="tab" onclick="showTab('optimize')">Optimize</button>
            <button class="tab" onclick="showTab('learn')">Learn</button>
            <button class="tab" onclick="showTab('update')">Update</button>
        </div>
        <div id="chat" class="tab-content active">
            <div class="form-group">
                <label>Message</label>
                <textarea id="chatMessage" placeholder="Ask the AI assistant anything..."></textarea>
            </div>
            <button onclick="sendChat()">Send</button>
            <div id="chatResult"></div>
        </div>
        <div id="audit" class="tab-content">
            <div class="form-group">
                <label>Target (file or directory)</label>
                <input type="text" id="auditTarget" placeholder="app/main.py">
            </div>
            <div class="form-group">
                <label>Audit Type</label>
                <select id="auditType">
                    <option value="code">Code</option>
                    <option value="security">Security</option>
                    <option value="performance">Performance</option>
                    <option value="config">Configuration</option>
                    <option value="dependencies">Dependencies</option>
                </select>
            </div>
            <button onclick="runAudit()">Run Audit</button>
            <div id="auditResult"></div>
        </div>
        <div id="repair" class="tab-content">
            <div class="form-group">
                <label>Issue Description</label>
                <textarea id="repairIssue" placeholder="Describe the issue to fix..."></textarea>
            </div>
            <div class="form-group">
                <label>File Path (optional)</label>
                <input type="text" id="repairFile" placeholder="app/main.py">
            </div>
            <button onclick="runRepair()">Repair</button>
            <div id="repairResult"></div>
        </div>
        <div id="optimize" class="tab-content">
            <div class="form-group">
                <label>Target File</label>
                <input type="text" id="optimizeTarget" placeholder="app/main.py">
            </div>
            <div class="form-group">
                <label>Optimization Type</label>
                <select id="optimizeType">
                    <option value="performance">Performance</option>
                    <option value="memory">Memory</option>
                    <option value="security">Security</option>
                    <option value="cost">Cost</option>
                </select>
            </div>
            <button onclick="runOptimize()">Optimize</button>
            <div id="optimizeResult"></div>
        </div>
        <div id="learn" class="tab-content">
            <div class="form-group">
                <label>Source (file or directory)</label>
                <input type="text" id="learnSource" placeholder="app/">
            </div>
            <div class="form-group">
                <label>Topic (optional)</label>
                <input type="text" id="learnTopic" placeholder="architecture">
            </div>
            <button onclick="runLearn()">Learn</button>
            <div id="learnResult"></div>
        </div>
        <div id="update" class="tab-content">
            <div class="form-group">
                <label>Requirements File (optional)</label>
                <input type="text" id="updateFile" placeholder="requirements.txt">
            </div>
            <button onclick="runUpdate()">Analyze Updates</button>
            <div id="updateResult"></div>
        </div>
    </div>
    <script>
        const API_BASE = '/api/ai';
        let currentBackend = null;
        window.addEventListener('DOMContentLoaded', () => { loadStatus(); });
        async function loadStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                document.getElementById('status').textContent = 
                    data.assistant_available ? 'âœ“ Available' : 'âœ— Not Available';
                currentBackend = data.current_backend;
                renderBackendSelector(data.backends);
            } catch (error) {
                document.getElementById('status').textContent = 'âœ— Error';
                console.error('Failed to load status:', error);
            }
        }
        function renderBackendSelector(backends) {
            const selector = document.getElementById('backendSelector');
            selector.innerHTML = '';
            for (const [name, info] of Object.entries(backends)) {
                const btn = document.createElement('button');
                btn.className = 'backend-btn';
                if (info.available) btn.classList.add('available');
                if (info.current) btn.classList.add('active');
                btn.textContent = name;
                btn.onclick = () => selectBackend(name);
                selector.appendChild(btn);
            }
        }
        async function selectBackend(backend) {
            try {
                const response = await fetch(`${API_BASE}/configure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ backend })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    currentBackend = backend;
                    loadStatus();
                }
            } catch (error) {
                alert('Failed to switch backend: ' + error.message);
            }
        }
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        async function sendChat() {
            const message = document.getElementById('chatMessage').value;
            if (!message) return;
            const resultDiv = document.getElementById('chatResult');
            resultDiv.innerHTML = '<div class="loading"></div> Loading...';
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, backend: currentBackend })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Response (${data.backend})</h3>
                            <pre>${data.response || 'No response'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        async function runAudit() {
            const target = document.getElementById('auditTarget').value;
            const type = document.getElementById('auditType').value;
            if (!target) return;
            const resultDiv = document.getElementById('auditResult');
            resultDiv.innerHTML = '<div class="loading"></div> Running audit...';
            try {
                const response = await fetch(`${API_BASE}/audit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target, audit_type: type })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Audit Results (${data.audit_type})</h3>
                            <pre>${data.findings || 'No findings'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        async function runRepair() {
            const issue = document.getElementById('repairIssue').value;
            const file = document.getElementById('repairFile').value || null;
            if (!issue) return;
            const resultDiv = document.getElementById('repairResult');
            resultDiv.innerHTML = '<div class="loading"></div> Analyzing issue...';
            try {
                const response = await fetch(`${API_BASE}/repair`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ issue, file_path: file })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Repair Solution</h3>
                            <pre>${data.fix || 'No fix provided'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        async function runOptimize() {
            const target = document.getElementById('optimizeTarget').value;
            const type = document.getElementById('optimizeType').value;
            if (!target) return;
            const resultDiv = document.getElementById('optimizeResult');
            resultDiv.innerHTML = '<div class="loading"></div> Analyzing for optimization...';
            try {
                const response = await fetch(`${API_BASE}/optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target, optimization_type: type })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Optimization Recommendations</h3>
                            <pre>${data.recommendations || 'No recommendations'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        async function runLearn() {
            const source = document.getElementById('learnSource').value;
            const topic = document.getElementById('learnTopic').value || null;
            if (!source) return;
            const resultDiv = document.getElementById('learnResult');
            resultDiv.innerHTML = '<div class="loading"></div> Learning from source...';
            try {
                const response = await fetch(`${API_BASE}/learn`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ source, topic })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Learned Knowledge</h3>
                            <pre>${data.knowledge || 'No knowledge extracted'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        async function runUpdate() {
            const file = document.getElementById('updateFile').value || null;
            const resultDiv = document.getElementById('updateResult');
            resultDiv.innerHTML = '<div class="loading"></div> Analyzing for updates...';
            try {
                const response = await fetch(`${API_BASE}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file_path: file })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>Update Recommendations</h3>
                            <pre>${data.recommendations || 'No recommendations'}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.detail || data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
